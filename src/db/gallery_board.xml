<?xml version="1.0"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GalleryBoard">
 <select id="selectOneClient">
    SELECT 
      * 
    FROM 
      gallery_board
    WHERE
      idx = ${idx}
  </select>
  <select id="selectAll">
    SELECT 
      member.name as write_name, 
      member.thumbnail as write_thumbnail, 
      gallery_board.* 
    FROM 
      gallery_board, member
    WHERE
      gallery_board.member_idx = member.idx
  </select>
  <select id="selectAllPage">
    SELECT 
      member.name as write_name, 
      member.thumbnail as write_thumbnail, 
      gallery_board.*
    FROM 
      gallery_board, member
    WHERE
      gallery_board.member_idx = member.idx
    <if test="title != ''">
    AND title LIKE CONCAT('%', #{title}, '%')
    </if>
    <if test="contents != ''">
    AND contents LIKE CONCAT('%', #{contents}, '%')
    </if>
    <if test="name != ''">
    AND name LIKE CONCAT('%', #{name}, '%')
    </if>
    ORDER BY idx desc
    LIMIT ${limit}, 20
  </select>
  <select id="selectAllPageClient">
    SELECT 
      *
    FROM 
      gallery_board
    WHERE
      1=1
    <if test="title != ''">
    AND title LIKE CONCAT('%', #{title}, '%')
    </if>
    ORDER BY idx desc
    LIMIT ${limit}, 9
  </select>
  <select id="countAllPage">
    SELECT 
      COUNT(*) AS row 
    FROM 
      gallery_board
    WHERE
      1=1
    <if test="title != ''">
    AND title LIKE CONCAT('%', #{title}, '%')
    </if>
    <if test="contents != ''">
    AND contents LIKE CONCAT('%', #{contents}, '%')
    </if>
    <if test="name != ''">
    AND name LIKE CONCAT('%', #{name}, '%')
    </if>
  </select>
  <select id="countAllPageClient">
    SELECT 
      COUNT(*) AS row 
    FROM 
      gallery_board
    WHERE
      1=1
    <if test="title != ''">
    AND title LIKE CONCAT('%', #{title}, '%')
    </if>
  </select>
  <select id="selectOne">
    SELECT 
      member.name as write_name, 
      member.thumbnail as write_thumbnail, 
      gallery_board.* 
    FROM 
      gallery_board, member
    WHERE
      gallery_board.member_idx = member.idx
    AND
      gallery_board.idx = ${idx}
  </select>
  <insert id="insertOne">
    INSERT INTO gallery_board
    (
      member_idx,
      thumbnail,
      title, 
      contents,
      hit,
      reg_date
    )
    VALUES
    (
      ${member_idx}, 
      #{thumbnail},
      #{title}, 
      #{contents},
      0,
      NOW()
    )
  </insert>
  <update id="updateOne">
    UPDATE 
      gallery_board 
    SET
      thumbnail = #{thumbnail},
      title = #{title}, 
      contents = #{contents}
    WHERE
      idx = ${idx}
  </update>
  <update id="updateOneHit">
    UPDATE 
      gallery_board 
    SET
      hit = hit+1
    WHERE
      idx = ${idx}
  </update>
  <delete id="deleteOne">
    DELETE
    FROM gallery_board
    WHERE
      idx = ${idx}
  </delete>
</mapper>